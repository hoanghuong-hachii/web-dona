<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Tìm kiếm</title>
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.5.1/jquery.min.js"></script>

    <link href="assets/fonts/fontawesome-free-6.5.1-web/css/fontawesome.css" rel="stylesheet">
    <link href="assets/fonts/fontawesome-free-6.5.1-web/css/brands.css" rel="stylesheet">
    <link href="assets/fonts/fontawesome-free-6.5.1-web/css/solid.css" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/normalize/8.0.1/normalize.min.css">
    <link rel="stylesheet" href="./assets/css/base.css">
    <link rel="stylesheet" href="./assets/css/main.css">
    <link rel="stylesheet" href="./assets/css/grid.css">
    <link rel="stylesheet" href="./assets/css/digitalsign.css">

    <link rel="stylesheet" href="./assets/css/home.css">
    <link rel="stylesheet" href="./assets/css/product_detail.css">
    <link rel="stylesheet" href="./assets/css/responsive.css">

    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link rel="stylesheet" href="./assets/fonts/themify-icons/themify-icons.css">
    <link href="https://fonts.googleapis.com/css2?family=Roboto:wght@100;300;400;500;700;900&display=swap" rel="stylesheet">    
</head>
<body>
    <div class="main">
        <div class="grid">
            <header class="header">
            </header>
        </div>

        <div id="container">
            <div class="grid wide">

                <div class="category_fillter-mobile">
                    <h3 class="title">Chọn mức giá</h3>
                    <ul>
                        <li class="item">
                            <input type="checkbox" name="item_price" id="">
                            <p>Dưới 100.000đ</p>
                        </li>
                        <li class="item">
                            <input type="checkbox" name="item_price" id="">
                            <p>Từ 100.000đ - 500.000đ</p>
                        </li>
                        <li class="item">
                            <input type="checkbox" name="item_price" id="">
                            <p>Từ 500.000đ - 1.000.000đ</p>
                        </li>
                        <li class="item">
                            <input type="checkbox" name="item_price" id="">
                            <p>Trên 1.000.000đ</p>
                        </li>
                        
                    </ul>
                </div>
                <div class="container-body">
                    <div class="row">
                        <div class="col l-2 m-2 c-0">
                            <div class="category_fillter">
                                <h3 class="title">Chọn mức giá</h3>
                                <ul>
                                    <li class="item">
                                        <input type="checkbox" name="item_price" id="">
                                        <p>Dưới 100.000đ</p>
                                    </li>
                                    <li class="item">
                                        <input type="checkbox" name="item_price" id="">
                                        <p>Từ 100.000đ - 500.000đ</p>
                                    </li>
                                    <li class="item">
                                        <input type="checkbox" name="item_price" id="">
                                        <p>Từ 500.000đ - 1.000.000đ</p>
                                    </li>
                                    <li class="item">
                                        <input type="checkbox" name="item_price" id="">
                                        <p>Trên 1.000.000đ</p>
                                    </li>
                                    
                                </ul>
                            </div>
                        </div>

                        <div class="col l-10 m-10 c-12">
                            <div class="container__trend">

                                <div class="trend-body">
                                    <h3 class="empty_key" style="
                                        line-height: 1.5;
                                        max-width: 590px;
                                        text-align: center;
                                        margin-top: 30px;
                                        color: #1B5E20;
                                        display: none;
                                    "
                                    >Rất tiếc, chúng tôi không tìm thấy kết quả nào cho từ khóa bạn tìm kiếm. Vui lòng thử lại với từ khóa khác</h3>
                                    <div id="product-search" class="row">
                                        
                                        <div class="col l-3 m-4 c-6 mt-8">
                                            <div class="product-body">
                                                <div class="product-body__img">
                                                    <img src="./assets/imgs/google-shopping-gel-rua-mat-svr.webp" alt="" class="product-img">
                                                    <a href="#" class="product-like"><svg width="18" height="18" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 64 64"><path fill="#000000" d="M31.91 61.67L29.62 60c-9.4-6.7-16.72-13.49-21.74-20.17C3.11 33.5.48 27.39.06 21.7A17.63 17.63 0 0 1 5.45 7.16a17 17 0 0 1 11.86-4.81c3.46 0 7.93.39 11.8 3.4A19.09 19.09 0 0 1 32 8.41a19.91 19.91 0 0 1 2.91-2.67c3.89-3 8.37-3.41 11.84-3.41a16.86 16.86 0 0 1 11.85 4.8 17.51 17.51 0 0 1 5.33 14.53c-.44 5.7-3.1 11.81-7.9 18.14C51 46.5 43.63 53.3 34.21 60zM8.51 10.38a13.31 13.31 0 0 0-4 11c.35 4.83 2.69 10.15 6.94 15.79 4.7 6.24 11.59 12.65 20.48 19 8.92-6.39 15.84-12.81 20.58-19.08 4.28-5.65 6.64-11 7-15.8a13.25 13.25 0 0 0-4-11 12.53 12.53 0 0 0-8.76-3.57c-2.76 0-6.29.29-9.11 2.48a12.37 12.37 0 0 0-3.09 3.15v.07L32 16l-2.5-3.56a12.68 12.68 0 0 0-3.11-3.2c-2.8-2.17-6.32-2.46-9.07-2.46a12.58 12.58 0 0 0-8.8 3.59z"></path></svg></i></a>
                                                    <a class="view_product btn_view-all open-modal-view">Xem nhanh</a>
                                                    <a class="add_cart btn_view-all open-modal-cart">Thêm vào giỏ</a>
                                                </div>
                                                <div class="product-body-content">
                                                    <h3 class="product-band">Maybelline</h3>
                                                    <h3 class="product-name">Son Lì Maybelline Mịn Môi Siêu Nhẹ 1299 Đỏ Cam Đất 1.7g</h3>
                                                    <div class="product-price">
                                                        <span class="product-price__new">170.000đ</span>
                                                        <span class="product-price__old">270.000đ</span>
                                                    </div>
                                                    
                                                </div>
                                            </div>
                                        </div>
        
        
                                    </div>
                                </div>
        
                                <div class="trend_btn-all">
                                    <button  class="btn_view-all mb-40">Xem tất cả</button>
                                </div>
                                
                            </div>
                        </div>
                    </div>
                   
                </div>
            </div>
        </div>

        <footer id="footer"></footer>
    </div>
    
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.5.1/jquery.min.js"></script>
    <script src="/assets/js/main.js"></script>
    <script src="/assets/js/home.js"></script>

    <script src="./assets/js/product_detail.js"></script>
    <script src="./assets/js/placeholderTypewriter.js"></script>
    <script src="assets/js/common.js"></script>

    <script>

        $(document).ready(function() {
            var keyword = getParameterByName('search');
            $(".header").load("base.html", function() {
                // Sau khi header được load, gán từ khóa vào ô tìm kiếm
                if (keyword) {
                    $('.navbar__search-input').val(keyword);
                }

                // Thêm sự kiện cho ô tìm kiếm sau khi nội dung header được load
                $('.navbar__search-input').keypress(function(event) {
                    if (event.keyCode === 13) {
                        console.log('enter');
                        event.preventDefault(); 
                        performSearch(); 
                    }
                });

                $('.navbar__search-btn').click(function() {
                    performSearch(); 
                });

                function performSearch() {
                    var keyword = $('.navbar__search-input').val(); 
                    console.log('Bạn đang tìm kiếm: ' + keyword);
                    window.location.href = './search_result.html?search=' + encodeURIComponent(keyword);
                }
            });

            $("#footer").load("footer.html")
        });
        
        
    </script>
    <script>
        function getParameterByName(name, url) {
            if (!url) url = window.location.href;
            name = name.replace(/[\[\]]/g, '\\$&');
            var regex = new RegExp('[?&]' + name + '(=([^&#]*)|&|#|$)'),
                results = regex.exec(url);
            if (!results) return null;
            if (!results[2]) return '';
            return decodeURIComponent(results[2].replace(/\+/g, ' '));
        }

        var keyword = getParameterByName('search');
        if (keyword) {
            
            console.log('Đang tìm kiếm với từ khóa: ' + keyword);
            var env_Url = localStorage.getItem('env_url');
            $.ajax({ 
                url:  env_Url+ '/api/v1/Products/roleUser/priceAndFilter?productName=' + keyword + '&sortDirection=asc',
                type: 'GET',
                headers: {
                    'ngrok-skip-browser-warning': 'true'
                },
                success: function(response) {
                    console.log(response)
                    if(Array.isArray(response) && response.length === 0){
                        $('.empty_key').show();
                        var productList = $('#product-search')
                        productList.empty();

                        $('.btn_view-all').hide()

                    } else {
                        $('.empty_key').hide(); 
                        updateUI(response);
                    }
                },
                error: function(xhr, status, error) {
                    console.log(error)
                }
            })
        } else {
            console.log('Không có từ khóa tìm kiếm được cung cấp trong URL.');
        }

        function updateUI(products) {
            var productList = $('#product-search')
            productList.empty();
            for (var i = 0; i < Math.min(products.length, 5); i++) {
                var product = products[i];
                
                var productHtml = `
                    <div class="col l-3 m-4 c-6 mt-8">
                        <a href="/product_detail.html?id=${product.idProd}">
                            <div class="product-body " id="${product.idProd}">
    
                                <div class="product-body__img">
                                    <img src="${product.imageAvatar}" alt="${product.productName}" class="product-img">
                                    <a href="#" class="product-like"><svg width="18" height="18" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 64 64"><path fill="#000000" d="M31.91 61.67L29.62 60c-9.4-6.7-16.72-13.49-21.74-20.17C3.11 33.5.48 27.39.06 21.7A17.63 17.63 0 0 1 5.45 7.16a17 17 0 0 1 11.86-4.81c3.46 0 7.93.39 11.8 3.4A19.09 19.09 0 0 1 32 8.41a19.91 19.91 0 0 1 2.91-2.67c3.89-3 8.37-3.41 11.84-3.41a16.86 16.86 0 0 1 11.85 4.8 17.51 17.51 0 0 1 5.33 14.53c-.44 5.7-3.1 11.81-7.9 18.14C51 46.5 43.63 53.3 34.21 60zM8.51 10.38a13.31 13.31 0 0 0-4 11c.35 4.83 2.69 10.15 6.94 15.79 4.7 6.24 11.59 12.65 20.48 19 8.92-6.39 15.84-12.81 20.58-19.08 4.28-5.65 6.64-11 7-15.8a13.25 13.25 0 0 0-4-11 12.53 12.53 0 0 0-8.76-3.57c-2.76 0-6.29.29-9.11 2.48a12.37 12.37 0 0 0-3.09 3.15v.07L32 16l-2.5-3.56a12.68 12.68 0 0 0-3.11-3.2c-2.8-2.17-6.32-2.46-9.07-2.46a12.58 12.58 0 0 0-8.8 3.59z"></path></svg></i></a>
                                    <img src="./assets/imgs/freeship_tag.webp" alt="" class="freeship_tag">
    
                                    <a class="view_product btn_view-all open-modal-view">Xem nhanh</a>
                                    <a class="add_cart btn_view-all open-modal-cart">Thêm vào giỏ</a>
                                </div>
                                <div class="product-body-content">
                                    <h3 class="product-band">${product.brand}</h3>
                                    <h3 class="product-name">${product.productName}</h3>
                                    <div class="product-price">
                                        <span class="product-price__new">${product.formattedDiscountedPrice}đ</span>
                                        <span class="product-price__old">${product.formattedPrice}đ</span>
                                    </div>
                                </div>
                            </div>
                        </a>
                    </div>
                `;
                productList.append(productHtml);
            }
        }
    </script>
  
</body>
</html>